<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"

                xmlns:c="http://java.sun.com/jsp/jstl/core">

<h:head>
<title>SkillMatrix</title>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   <h:outputStylesheet library="css" name="screen.css" />
   <h:outputStylesheet>
		.sbrcol {
		  width: 60px;
		  text-align: center;
		}
		.fixednamecol {
		  width: 120px;
		}
	</h:outputStylesheet>
</h:head>
<h:body>

	

	<a4j:queue requestDelay="0" />
	
	<div class="extendedcontainer">
	<div style="float: right; margin-right: 200px;">
	 <h:form>
        <h:commandLink value="What is this?" style="font-size: small;">
          <rich:componentControl target="helppopup" operation="show" />
        </h:commandLink><br/>
		<h:commandLink value="#{matrixController.allowColors? 'Disable colors' : 'Enable Colors'}" action="#{matrixController.switchAllowColors}" />
	    
	    <rich:popupPanel id="helppopup" modal="true" width="500" height="400" resizeable="true" onmaskclick="#{rich:component('helppopup')}.hide()">
	      <f:facet name="header">
	        What is this?
	      </f:facet>
	      <f:facet name="controls">
	        <h:outputLink value="#" onclick="#{rich:component('helppopup')}.hide(); return false;">X</h:outputLink>
	      </f:facet>
	      
	    <p style="font-size: small;">
	     This page offers a quick overview of members knowledge of SBRs and their classification in SBRs.
	     Thus you can quickly see who is in wrong SBR, or what SBR would be a good fit for a certain member.
	    </p>
	    <p style="font-size: small;">
	     In every cell you can see some confusing numbers. There is some percentage,
	      it should be always there and it shows how well the member knows the sbr (0% = no knowlegde, 100% = complete knowledge).
	      Optionally, in front of the percentage, there is a number showing as which the member has the sbr (eg. first SBR, second SBR, ...).<br/>
	    </p>
	   
        <div style="font-size: small;"> Example:
	     <div style="width: 60px; background: #f9f8f8; border: 1px solid #404040; text-align: center; font-size: small;">2. / 70%</div>
	   	  shows that a member has an sbr as his second and knows this sbr at 70%.</div>	  
	   	  
	   	<p style="font-size: small">
	   	  Some cells may have a background color. <font style="color: #00AA00">Green</font> shows that the knowledge and SBR membership is right,
	   	   e.g. member should have some knowledge of his first SBR (say 70%) but when he has 100% knowledge it is <font style="color: #00AA00">great</font>.<br/>
	   	   Likewise <font style="color: #aa0000">red</font> shows that something is not right, e.g. when a member has just 10% knowledge of his first SBR, it is 
	   	   <font style="color: #AA0000">not good</font>.
	   	</p>
	   
	    
	 
	    <br/>
 		<h:commandButton value="close" style="float:right;">
 		  <rich:componentControl target="helppopup" operation="hide" />
 		</h:commandButton>

	    </rich:popupPanel>
	  
</h:form>
	</div>
	
	<h1 class="mainheading">Skill-Matrix</h1>
	
	<h:form>
	<div style="overflow-x: auto; overflow-y: hidden; " >
	<rich:dataTable id="matrix" value="#{matrixController.memberHelper.model}"
			 var="member" styleClass="matrixtable" 
			  columnClasses="#{matrixController.generateColumnStyles('fixednamecol','sbrcol', SBRs.size())}" rendered="#{not empty SBRs and not empty matrixController.memberHelper.model.isEmpty()}">
		<rich:column>
		  <f:facet name="header">
		    <a4j:commandLink value="Name" render="matrix" action="#{matrixController.memberHelper.sortByName}" /><br/>
		    <h:inputText value="#{matrixController.memberHelper.nameFilter}" size="13" >
		      <a4j:ajax event="keyup" render="@body" execute="@this" >
		      	<a4j:attachQueue requestGroupingId="nameFilter"  requestDelay="200"/>
		      </a4j:ajax>
		    </h:inputText>
		  </f:facet>
		
		<h:outputLink value="memberdetail.jsf?id=#{member.id}" styleClass="name">
			<h:outputText value="#{member.name}" styleClass="name"/>
		</h:outputLink>
		</rich:column>
		<c:forEach items="#{SBRs}" var="sbr">
			<rich:column  style="background-color: #{matrixController.getColor(member,sbr)}; color: #{matrixController.getTextColor(member,sbr)};">
				<f:facet name="header">
				<h:outputLink value="sbrdetail.jsf?id=#{sbr.id}" >
					<h:outputText value="#{sbr.name}" />
				</h:outputLink>
				</f:facet>
				
				
					<rich:tooltip followMouse="false" mode="ajax"  showDelay="800" direction="bottomAuto" layout="block">
						<a4j:attachQueue requestGroupingId="matrixTooltip" requestDelay="500" />
						
						
						<h:panelGrid columns="2" style="font-size: small;">
							<h:outputText value="SBR: "  styleClass="tooltiphighlight"/>
							<h:outputText value="#{sbr.name}"  />
							
							<h:outputText value="% of members knowledge:" styleClass="tooltiphighlight"/>
							<h:outputText value="#{matrixController.getMemberSbrRatio(member, sbr)}%" />
						</h:panelGrid>
						
							<hr/>
						

							<h:panelGrid columns="2" style="font-size: small;">
								<h:outputText value="Member:" styleClass="tooltiphighlight"/>
								<h:outputText value="#{member.name}" />
								
								<h:outputText value="Nick:" styleClass="tooltiphighlight"/>
								<h:outputText value="#{member.nick}" />
								
								<h:outputText value="Email:"  styleClass="tooltiphighlight"/>
								<h:outputText value="#{member.email}" />
								
								<h:outputText value="SBRs:"  styleClass="tooltiphighlight"/>
								<h:outputText value="#{matrixController.getSbrsString(member)}" />
								
								<h:outputText value="Knowledge of this SBR:" styleClass="tooltiphighlight"/>
								<h:outputText value="#{matrixController.getPercentageString(member, sbr)}" />
							</h:panelGrid>
						
					</rich:tooltip>
					
				<h:outputText  value="#{matrixController.getSbrString(member,sbr)}#{matrixController.getPercentageString(member,sbr)}" escape="false" />
			</rich:column>
		</c:forEach>
		
		
	</rich:dataTable>	
	</div>
	<div style="text-align: center">
      <rich:dataScroller for="matrix" maxPages="5"  fastStep="5" renderIfSinglePage="false"/>
    </div>
	</h:form>
	
	</div>
	</h:body>
</html>