<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	template="/WEB-INF/templates/default.xhtml"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j">

	<f:metadata>
		<f:event type="preRenderView"
			listener="#{conversationController.beginConversation}" />
	</f:metadata>

	<ui:define name="title">Search members</ui:define>
	<ui:define name="content">
		<h:outputStylesheet>
		.slim {
			width: 300px;
		}
	
	</h:outputStylesheet>
	
	   <a4j:queue requestDelay="100" ignoreDupResponses="true"/>
	   
		<h1>Search members:</h1>
		<h:form id="search">
			<rich:collapsiblePanel header="Basic search" switchType="client"
				expanded="false">
				<h:panelGrid columns="2">
					<h:outputLabel value="Name" for="name" />
					<h:inputText id="name" value="#{searchController.name}" />

					<h:outputLabel value="Nick" for="nick" />
					<h:inputText id="nick" value="#{searchController.nick}" />

					<h:outputLabel value="Email" for="email" />
					<h:inputText id="email" value="#{searchController.email}" />
					
					<h:outputLabel value="Languages" for="languages" />
					<h:inputText id="languages" value="#{searchController.languages}" title="coma separated values of languages" placeholder="Languages"/>
				</h:panelGrid>

			</rich:collapsiblePanel>
			<rich:collapsiblePanel header="Advanced search" switchType="client">
				<h:outputText value="Number of knowledges at level " />
				<h:selectOneMenu value="#{searchController.numknowlevel}"
					converter="javax.faces.Integer">
					<f:selectItem itemValue="-1" itemLabel="all levels"
						 />
					<f:selectItem itemValue="0" itemLabel="beginner" noSelectionOption="true" />
					<f:selectItem itemValue="1" itemLabel="intermediate" />
					<f:selectItem itemValue="2" itemLabel="expert" />
				</h:selectOneMenu>
				<h:outputText value=" is " />
				<h:selectOneMenu value="#{searchController.numknowtype}">
					<f:selectItem itemLabel="bigger than" itemValue="g" />
					<f:selectItem itemLabel="smaller than" itemValue="s" />
					<f:selectItem itemLabel="equal to" itemValue="e" />
					<f:selectItem itemLabel="bigger than or equal to" itemValue="ge" />
					<f:selectItem itemLabel="smaller than or equal to" itemValue="se" />
				</h:selectOneMenu>
				<h:inputText id="numknowvalue"
					value="#{searchController.numknowvalue}" size="5"
					validatorMessage="Must be number.">
					<f:validateRegex pattern="[0-9]*" />
					<rich:validator />
				</h:inputText>
				<br />
				<rich:message for="numknowvalue" />
			</rich:collapsiblePanel>
			<rich:collapsiblePanel header="Search by tag" switchType="client">
				<h:commandLink value="Add tags" >
					<rich:componentControl target="pkgpopup" operation="show" />
				</h:commandLink>

				<h:panelGroup id="selectedpkgs">
					<h3><h:outputText value="no tags added" rendered="#{empty searchHolder.packageMap}"/></h3>
					<rich:dataTable rendered="#{not empty searchHolder.packageMap}"
						value="#{searchHolder.packageMap.keySet().toArray()}" var="pkg">
						<rich:column sortBy="#{pkg.name}" sortOrder="ascending">
							<h:outputText value="#{pkg.name}" styleClass="name" />
						</rich:column>

						<rich:column>
							<h:selectOneMenu value="#{searchHolder.packageMap[pkg]}">
								<f:selectItem itemValue="0" itemLabel="any knowledge" />
								<f:selectItem itemValue="1" itemLabel="intermediate or better" />
								<f:selectItem itemValue="2" itemLabel="must be expert" />
							</h:selectOneMenu>
						</rich:column>

						<rich:column>
							<a4j:commandLink value="remove"
								action="#{searchHolder.removePackage(pkg)}"
								render="selectedpkgs choosepkg" execute="@this" />
						</rich:column>

					</rich:dataTable>
				</h:panelGroup>
			</rich:collapsiblePanel>

			<a4j:commandButton value="Search" styleClass="submit"
				action="#{searchController.doSearch}" render="@form" />
		</h:form>

		<rich:popupPanel id="pkgpopup" modal="true" autosized="true"
			onmaskclick="#{rich:component('pkgpopup')}.hide(); return false;" >
			<f:facet name="header">Add tags</f:facet>
			<f:facet name="controls">
				<h:outputLink value="#"
					onclick="#{rich:component('pkgpopup')}.hide(); return false;">
			X
			<rich:componentControl target="pkgpopup" operation="hide" />
				</h:outputLink>
			</f:facet>

			<h:form>
				<rich:dataTable id="choosepkg" value="#{searchHolder.pkgHelper.model}" var="pkg"
					rows="6" styleClass="simpletablestyle slim"
					columnClasses="namecol,namecol, numcol">
					<rich:column >
						<f:facet name="header">
							<a4j:commandLink value="Tag"
								action="#{searchHolder.pkgHelper.sortByName()}"
								render="choosepkg" styleClass="whitelink" />
							<h:inputText value="#{searchHolder.pkgHelper.nameFilter}"
								size="13">
								<a4j:ajax event="keyup" render="@body @footer" execute="@this" />
							</h:inputText>
						</f:facet>
						<h:outputText value="#{pkg.name}" styleClass="name" />
					</rich:column>

					<rich:column >
						<f:facet name="header">
							<a4j:commandLink value="SBR" render="choosepkg"
								action="#{searchHolder.pkgHelper.sortBySbr()}"
								styleClass="whitelink" />
							<h:inputText value="#{searchHolder.pkgHelper.sbrFilter}">
								<a4j:ajax event="keyup" render="@body @footer" execute="@this" />
							</h:inputText>
						</f:facet>
						<h:outputText value="#{pkg.sbr.name}" />
					</rich:column>

					<rich:column>
						<a4j:commandLink value="add"
							action="#{searchHolder.addPackage(pkg)}" render="messages choosepkg search:selectedpkgs" />
					</rich:column>
					<f:facet name="footer">
						<rich:dataScroller for="choosepkg" fastStep="5" />
					</f:facet>
				</rich:dataTable>
				<br />
				<a4j:commandButton  value="close" onclick="#{rich:component('pkgpopup')}.hide(); return false;" style="float: right"/>
				<rich:messages  />
			</h:form>
			<a4j:ajax event="show" execute="selectedpkgs" />
		</rich:popupPanel>
	</ui:define>
</ui:composition>
