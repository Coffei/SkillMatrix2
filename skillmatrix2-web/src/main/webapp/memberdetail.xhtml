<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	template="/WEB-INF/templates/default.xhtml"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j">

	<ui:define name="title">Member <h:outputText
			value="#{packageDetail.package.name}"
			rendered="#{packageDetail.package ne null}" />
	</ui:define>
	<ui:define name="content">
		<h:outputStylesheet>
		.slim {
			width: 250px;
		}
		.black {
			color: black;
		}
	</h:outputStylesheet>
	
	   <a4j:queue requestDelay="100" ignoreDupResponses="true"/>

		<h:panelGroup rendered="#{memberDetail.member eq null}">
			<h2>No member found</h2>
			<h2>
				<h:outputLink value="members.jsf">View all Members</h:outputLink>
			</h2>
		</h:panelGroup>

		<h:panelGroup rendered="#{memberDetail.member ne null}">
			<h1>
				Member:
				<h:outputText value="#{memberDetail.member.name}" />
			</h1>
			<h:panelGrid columns="2" columnClasses="memberdetailshead,memberdetails">
				<h:outputText value="Nick: " />
				<h:outputText value="#{memberDetail.member.nick}" />
				
				<h:outputText value="Email: " />
				<h:outputText value="#{memberDetail.member.email}" />
				
				<h:outputText value="Role: " />
				<h:outputText value="#{memberDetail.member.role}" />
				
				<h:outputText value="Geo: " />
				<h:outputText value="#{memberDetail.member.geo}" />
				
				<h:outputText value="Extension: " />
				<h:outputText value="#{memberDetail.member.extension}" />

                <h:outputText value="Languages: "/>
                <h:outputText value="#{memberDetail.languages}"/>
			
			</h:panelGrid>
			
<!-- 			<h2> -->
<!-- 				<h:outputText value="Nick: #{memberDetail.member.nick}" -->
<!-- 					styleClass="memberdetails" /> -->
<!-- 			</h2> -->
<!-- 			<h2> -->
<!-- 				<h:outputText value="Email: #{memberDetail.member.email}" -->
<!-- 					styleClass="memberdetails" /> -->
<!-- 			</h2> -->
<!-- 			<h2> -->
<!-- 				<h:outputText value="Role: #{memberDetail.member.geo}"/> -->
<!-- 			</h2> -->
<!-- 			<h2> -->
<!-- 				<h:outputText value="Extension: #{memberDetail.member.extension}" /> -->
<!-- 			</h2> -->
			<rich:collapsiblePanel header="SBRs" switchType="client">
			<h:panelGroup rendered="#{empty memberDetail.member.membersbrs}">
			  <h3>
			  	No SBRs.
			  </h3>
			</h:panelGroup>
				<rich:dataTable value="#{memberDetail.member.membersbrs}" var="ms"
					styleClass="simpletablestyle slim" rendered="#{not empty memberDetail.member.membersbrs}">
					<rich:column>
						<h:outputText value="#{ms.level}. SBR" styleClass="sbrname" />
					</rich:column>
					<rich:column>
						<h:outputLink value="sbrdetail.jsf?id=#{ms.sbr.id}">
							<h:outputText value="#{ms.sbr.name}" styleClass="sbrvalue black" />
						</h:outputLink>
					</rich:column>

				</rich:dataTable>
			</rich:collapsiblePanel>

			<rich:collapsiblePanel header="Knowledge" switchType="client">
	          <h:panelGroup rendered="#{memberDetail.helpers[2].model.isEmpty()}">
				  <h3>
					No expert knowledge
				  </h3>
				</h:panelGroup >
				<h:form>
					<rich:dataTable id="experts" value="#{memberDetail.helpers[2].model}"
						var="pkg" rendered="#{not memberDetail.helpers[2].model.isEmpty()}"
						styleClass="simpletablestyle" rows="6"
						columnClasses="namecol,namecol,actioncol">
						<f:facet name="caption">
							<h3><h:outputText value="Expert (#{memberDetail.countPackages(2)})" /></h3>
						</f:facet>
						
						<rich:column>
						<f:facet name="header">
								<a4j:commandLink value="Name "
									action="#{memberDetail.helpers[2].sortByName}"
									render="experts" styleClass="whitelink" />
								<h:inputText value="#{memberDetail.helpers[2].nameFilter}"
									size="15">
									<a4j:ajax event="keyup" render="@body @footer" execute="@this" />
								</h:inputText>
							</f:facet>
							<h:outputText value="#{pkg.name}" styleClass="name" />
						</rich:column>
						
					  <rich:column>
 						  <f:facet name="header">
							   <a4j:commandLink value="SBR name " action="#{memberDetail.helpers[2].sortBySbr}" render="experts" styleClass="whitelink"/>
							   <h:inputText value="#{memberDetail.helpers[2].sbrFilter}" size="10" >
							   		<a4j:ajax event="keyup" render="@body @footer" execute="@this" />
  						 	   </h:inputText>
 						  </f:facet>
 						  <h:outputText value="#{pkg.sbr.name}" />
 					  </rich:column>
   

						<rich:column>
							<f:facet name="header">Actions</f:facet>
							<h:outputLink value="./pkgdetail.jsf?id=#{pkg.id}">view </h:outputLink>
							<h:outputLink value="./pkgform.jsf?editid=#{pkg.id}">edit</h:outputLink>
						</rich:column>

						<f:facet name="footer">
							<rich:dataScroller for="experts" maxPages="5" fastStep="10" />
						</f:facet>

					</rich:dataTable>
				</h:form>
				
				<h:panelGroup rendered="#{memberDetail.helpers[1].model.isEmpty()}">
				  <h3>
					No intermediate knowledge
				  </h3>
				</h:panelGroup>

				<h:form>
					<rich:dataTable id="mediums" value="#{memberDetail.helpers[1].model}"
						var="pkg" rendered="#{not memberDetail.helpers[1].model.isEmpty()}"
						styleClass="simpletablestyle" rows="6"
						columnClasses="namecol,namecol,actioncol">
						<f:facet name="caption">
							<h3><h:outputText value="Intermediate (#{memberDetail.countPackages(1)})" /></h3>
						</f:facet>
						
						<rich:column>
							<f:facet name="header">
								<a4j:commandLink value="Name "
									action="#{memberDetail.helpers[1].sortByName}"
									render="mediums" styleClass="whitelink" />
								<h:inputText value="#{memberDetail.helpers[1].nameFilter}"
									size="15">
									<a4j:ajax event="keyup" render="@body @footer" execute="@this" />
								</h:inputText>
							</f:facet>
							<h:outputText value="#{pkg.name}" styleClass="name" />
						</rich:column>
						
					  <rich:column>
 						  <f:facet name="header">
							   <a4j:commandLink value="SBR name " action="#{memberDetail.helpers[1].sortBySbr}" render="mediums" styleClass="whitelink"/>
							   <h:inputText value="#{memberDetail.helpers[1].sbrFilter}" size="10" >
							   		<a4j:ajax event="keyup" render="@body @footer" execute="@this" />
  						 	   </h:inputText>
 						  </f:facet>
 						  <h:outputText value="#{pkg.sbr.name}" />
 					  </rich:column>

						<rich:column>
							<f:facet name="header">Actions</f:facet>
							<h:outputLink value="./pkgdetail.jsf?id=#{pkg.id}">view </h:outputLink>
							<h:outputLink value="./pkgform.jsf?editid=#{pkg.id}">edit</h:outputLink>
						</rich:column>

						<f:facet name="footer">
							<rich:dataScroller for="mediums" maxPages="5" fastStep="10" />
						</f:facet>

					</rich:dataTable>
				</h:form>
				
				
				<h:panelGroup rendered="#{memberDetail.helpers[0].model.isEmpty()}">
				  <h3>
					No beginner knowledge
				  </h3>
				</h:panelGroup>

				<h:form>
					<rich:dataTable id="beginners" value="#{memberDetail.helpers[0].model}"
						var="pkg" rendered="#{not memberDetail.helpers[0].model.isEmpty()}"
						styleClass="simpletablestyle" rows="6"
						columnClasses="namecol,namecol,actioncol">
						<f:facet name="caption">
							<h3><h:outputText value="Beginner (#{memberDetail.countPackages(0)})" /></h3>
						</f:facet>
						
						<rich:column>
						<f:facet name="header">
								<a4j:commandLink value="Name "
									action="#{memberDetail.helpers[0].sortByName}"
									render="beginners" styleClass="whitelink" />
								<h:inputText value="#{memberDetail.helpers[0].nameFilter}"
									size="15">
									<a4j:ajax event="keyup" render="@body @footer" execute="@this" />
								</h:inputText>
							</f:facet>
							<h:outputText value="#{pkg.name}" styleClass="name" />
						</rich:column>
						
					  <rich:column>
 						  <f:facet name="header">
							   <a4j:commandLink value="SBR name " action="#{memberDetail.helpers[0].sortBySbr}" render="beginners" styleClass="whitelink"/>
							   <h:inputText value="#{memberDetail.helpers[0].sbrFilter}" size="10" >
							   		<a4j:ajax event="keyup" render="@body @footer" execute="@this" />
  						 	   </h:inputText>
 						  </f:facet>
 						  <h:outputText value="#{pkg.sbr.name}" />
 					  </rich:column>

						<rich:column>
							<f:facet name="header">Actions</f:facet>
							<h:outputLink value="./pkgdetail.jsf?id=#{pkg.id}">view </h:outputLink>
							<h:outputLink value="./pkgform.jsf?editid=#{pkg.id}">edit</h:outputLink>
						</rich:column>

						<f:facet name="footer">
							<rich:dataScroller for="beginners" maxPages="5" fastStep="10" />
						</f:facet>

					</rich:dataTable>
				</h:form>

			</rich:collapsiblePanel>
			
			<rich:collapsiblePanel header="Statistics" switchType="client" styleClass="stattext" rendered="#{not memberDetail.packageKnowledgesEmpty}">
				<div class="stattext">
				<p>Expert knowledge: 
				<h:outputText value="#{statsProvider.getPackagesInSbrsPercentage(memberDetail.member, 2)}% in " styleClass="stathighlight" />  
				own SBRs <h:outputText value="#{statsProvider.getPackagesOutSbrsPercentage(memberDetail.member, 2)}% out " styleClass="stathighlight" /> of own SBRS.
				<br/>
				Intermediate knowledge: 
				<h:outputText value="#{statsProvider.getPackagesInSbrsPercentage(memberDetail.member, 1)}% in " styleClass="stathighlight"/>
				own SBRs <h:outputText value="#{statsProvider.getPackagesOutSbrsPercentage(memberDetail.member, 1)}% out " styleClass="stathighlight"/> of own SBRS.
				</p>
				<p>
				
				<rich:dataTable id="sbrstat" value="#{statsProvider.getPercentageOfKnowledgeInSbrs(memberDetail.member)}" rows="4" var="entry" styleClass="simpletablestyle slim" columnClasses="namecol,numcol,numcol">
						<rich:column>
							<f:facet name="header">SBR</f:facet>
							<h:outputText value="#{entry.key.name}" />
						</rich:column>
						
						<rich:column>
							<f:facet name="header">Percentage of member's knowledge</f:facet>
							<h:outputText value="#{entry.value}%" />
						</rich:column>
						
						<rich:column>
							<f:facet name="header">Actions</f:facet>
							<h:outputLink value="sbrdetail.jsf?id=#{entry.key.id}">view</h:outputLink>
						</rich:column>
					
					<f:facet name="footer">
						<rich:dataScroller for="sbrstat" maxPages="5" fastStep="5" />
					</f:facet>
				</rich:dataTable>
				</p>
				</div>
			</rich:collapsiblePanel>
		</h:panelGroup>


	</ui:define>
</ui:composition>
