<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	template="/WEB-INF/templates/default.xhtml"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">

	<!-- <f:metadata>
		<f:event type="preRenderView"
			listener="#{conversationController.beginConversation}"></f:event>
	</f:metadata>  -->


	<ui:define name="title">Member</ui:define>
	<ui:define name="content">
		<h:outputStylesheet>
	    .rf-dg, .rf-dg-c{
       		border:none;
        }
		</h:outputStylesheet>
		
		   <a4j:queue requestDelay="100" ignoreDupResponses="false"/>
	
		<h2>
			<h:outputText
				value="#{memberController.editing? 'Edit member:' : 'New member:'}" />
		</h2>

		<h:outputLink value="memberform.jsf"
			rendered="#{memberController.editing}">Create new Member</h:outputLink>

		<h:form id="member" styleClass="form">
			<h:inputHidden value="#{memberController.editMember.id}" />
			<h:panelGrid columns="3">
				<h:outputText value="Name: " for="name" />
				<h:inputText value="#{memberController.editMember.name}" id="name" />
				<h:message for="name" errorClass="error" />

				<h:outputText value="Nick: " for="nick" />
				<h:inputText value="#{memberController.editMember.nick}" id="nick" />
				<h:message for="nick" errorClass="error" />

				<h:outputText value="Email: " for="email" />
				<h:inputText value="#{memberController.editMember.email}" id="email" />
				<h:message for="email" errorClass="error" />
				
				<h:outputText value="Extension:" for="extension"/>
				<h:inputText value="#{memberController.editMember.extension}" id="extension" />
				<h:message for="extension" errorClass="error"/>

				<h:outputText value="Role: " for="role"/>
				<h:selectOneMenu value="#{memberController.editMember.role}" id="role">
					<f:selectItem itemLabel="---" itemValue=""/>
					<f:selectItems value="#{memberController.roleEnumValues}" var="role"  />
								</h:selectOneMenu>
				<h:message for="role" errorClass="error"/>
				
				<h:outputText value="Geo: " for="geo" />
				<h:selectOneMenu value="#{memberController.editMember.geo}" id="geo">
					<f:selectItem itemLabel="---" itemValue=""/>
					<f:selectItems value="#{memberController.geoEnumValues}">
					</f:selectItems>
					<f:converter converterId="geoconverter" />
				</h:selectOneMenu>
				<h:message for="geo" errorClass="error"/>
				
				
			</h:panelGrid>
			<h:dataTable id="sbrs" value="#{memberController.sbrsCount}" var="num"
				columnClasses="namecol,actioncol">
				<h:column>
					<h:outputText value="#{num}. SBR" />
				</h:column>

				<h:column>
					<h:selectOneMenu value="#{memberController.sbrs[num-1]}"
						converter="javax.faces.Long">
						<f:selectItem itemLabel="-no sbr-" itemValue="-1" />
						<f:selectItems value="#{SBRs}" var="sbr" itemLabel="#{sbr.name}"
							itemValue="#{sbr.id}" />
					</h:selectOneMenu>
				</h:column>
				<f:facet name="footer">
					<a4j:commandLink value="Add SBR" action="#{memberController.addSbr}" execute="sbrs" render="sbrs"/>
				</f:facet>
			</h:dataTable>
			
			<rich:panel id="languages" header="Languages">
				<rich:dataGrid value="#{memberController.languages}" iterationStatusVar="state" columns="4">
					<h:inputText value="#{memberController.languages[state.index]}" size="10" />
				</rich:dataGrid>
				<a4j:commandLink value="Add language" action="#{memberController.addLanguage()}" execute="languages" render="languages"/>
			</rich:panel>
			
			<rich:collapsiblePanel header="Knowledge" switchType="client" >
			
				<h:outputLink value="enterknowledge.jsf?id=#{memberController.editMember.id}" onclick="return confirm('Changes made on this page will not be saved!\nContinue?');" rendered="#{memberController.editing}">One-page knowledge editor</h:outputLink>

				<h:panelGroup rendered="#{memberController.helper.model.isEmpty()}">
					<h3>
						<h:outputText value="No tags, add some first." />
					</h3>
				</h:panelGroup>
				<h:panelGroup rendered="#{not memberController.helper.model.isEmpty()}">
				<rich:dataTable id="knows" rows="6"
					value="#{memberController.helper.model}"
					 var="pkg"
					styleClass="simpletablestyle"
					columnClasses="namecol,namecol,selectcol">
					<rich:column >
						<f:facet name="header">
							<a4j:commandLink value="Name "
								action="#{memberController.helper.sortByName}"
								render="knows" execute="knows" styleClass="whitelink" /><br/>
							<h:inputText value="#{memberController.helper.nameFilter}"
								size="13">
								<a4j:ajax event="keyup" render="@body @footer" execute="knows" />
                                <a4j:ajax event="mousedown" render="@body @footer" execute="knows"/>
							</h:inputText>
						</f:facet>
						<h:outputText value="#{pkg.name}" styleClass="name" />
					</rich:column>

					<rich:column >
						<f:facet name="header">
							<a4j:commandLink value="SBR name "
								action="#{memberController.helper.sortBySbr}"
								render="knows" execute="knows" styleClass="whitelink" /><br/>
							<h:inputText  value="#{memberController.helper.sbrFilter}"
								size="10">
								<a4j:ajax event="keyup" render="@body @footer" execute="knows" />
                                <a4j:ajax event="mousedown" render="@body @footer" execute="knows"/>
							</h:inputText>
						</f:facet>
						<h:outputText value="#{pkg.sbr.name}" />
					</rich:column>

					<rich:column>
						<f:facet name="header">
						  <a4j:commandLink value="Select level of knowledge" action="#{memberController.sortByLevel}"
						    		render="knows" execute="knows" styleClass="whitelink"/> 
						</f:facet>
						<h:selectOneMenu value="#{memberController.knowledgeMap[pkg]}"
							converter="javax.faces.Integer" style="font-size: small">
							<f:selectItem itemLabel="no knowledge" itemValue="-1"
								noSelectionOption="true" />
							<f:selectItem itemLabel="Beginner" itemValue="0" />
							<f:selectItem itemLabel="Intermediate" itemValue="1" />
							<f:selectItem itemLabel="Expert" itemValue="2" />
						</h:selectOneMenu>
					</rich:column>


					<f:facet name="footer">
						<rich:dataScroller for="knows" maxPages="5" fastStep="10"
							execute="knows" />
					</f:facet>
				</rich:dataTable>
				</h:panelGroup>
			</rich:collapsiblePanel>
			<h:messages globalOnly="true" errorClass="error" infoClass="success" />
			<h:commandButton
				value="#{memberController.editing? 'Update' : 'Create' }"
				action="#{memberController.submitNewMember}" styleClass="submit" />
		</h:form>
	</ui:define>
</ui:composition>