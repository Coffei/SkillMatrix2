<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                template="/WEB-INF/templates/default.xhtml"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                xmlns:rich="http://richfaces.org/rich"
                xmlns:a4j="http://richfaces.org/a4j">
    <ui:define name="title">Edit knowledges</ui:define>
    <ui:define name="content">
        <h:panelGroup rendered="#{knowledgeForm.member eq null}">
            <div class="alert alert-warning">
                <h3>No member found. <small>Double check the id and try again.</small></h3>
            </div>
        </h:panelGroup>
        <h:panelGroup rendered="#{knowledgeForm.member ne null}">
            <div class="page-header">
                <h2><h:outputText value="Edit knowledge: #{knowledgeForm.member.name}"/></h2>
            </div>


            <h:messages globalOnly="true" styleClass="no-dot" infoClass="alert alert-success" errorClass="alert alert-danger"/>
            <a4j:queue name="slowQueue" requestDelay="100" ignoreDupResponses="false" />
            <a4j:log level="DEBUG" mode="console"/>


            <h:form>
                <h:panelGroup id="panel_header">
                    <ul class="nav nav-tabs">
                        <li class="#{rich:findComponent('panel').activeItem eq 'table' ? 'active' : ''}">

                            <a4j:commandLink execute="@this" render="panel_header" onclick="#{rich:component('panel')}.switchToItem('table'); return true;">
                                <i class="icon-table"/> Table view
                            </a4j:commandLink>
                        </li>

                        <li class="#{rich:findComponent('panel').activeItem eq 'list' ? 'active' : ''}">
                            <a4j:commandLink execute="@this" render="panel_header" onclick="#{rich:component('panel')}.switchToItem('list'); return true;" >
                                <i class="icon-list"/> List view
                            </a4j:commandLink>
                        </li>
                    </ul>
                </h:panelGroup>

                <rich:togglePanel id="panel" activeItem="table">
                    <rich:togglePanelItem name="table" style="margin-top: 10px">
                        <a4j:jsFunction name="saveKnowledges" execute="knows@body" />
                        <rich:dataTable value="#{knowledgeForm.pkgModelHelper.model}" var="pkg" styleClass="table table-striped"
                                        id="knows">
                            <f:facet name="header">
                                <rich:columnGroup>
                                    <rich:column>
                                        <div class="parent">
                                            <div class="cell">
                                                <h:panelGroup rendered="#{knowledgeForm.pkgModelHelper.nameOrder ne 'unsorted'}">
                                                    <i class="caret"/>
                                                </h:panelGroup>
                                                <a4j:commandLink value="Name" action="#{knowledgeForm.pkgModelHelper.sortByName()}"
                                                                 render="@body @footer @header" />
                                            </div>
                                            <div class="col-lg-8 cell">
                                                <h:inputText value="#{knowledgeForm.pkgModelHelper.nameFilter}" styleClass="form-control input-sm" >
                                                    <a4j:ajax event="keyup" render="@body @footer" execute="@header" queueId="slowQueue" />
                                                    <a4j:ajax event="focus" execute="knows" queueId="slowQueue"/>
                                                </h:inputText>
                                            </div>
                                        </div>

                                    </rich:column>
                                    <rich:column>
                                        <div class="parent">
                                            <div class="cell">
                                                <h:panelGroup rendered="#{knowledgeForm.pkgModelHelper.sbrOrder ne 'unsorted'}">
                                                    <i class="caret"/>
                                                </h:panelGroup>
                                                <a4j:commandLink value="SBR" action="#{knowledgeForm.pkgModelHelper.sortBySbr()}"
                                                                 render="@body @footer @header" />
                                            </div>
                                            <div class="col-lg-8 cell">
                                                <h:inputText value="#{knowledgeForm.pkgModelHelper.sbrFilter}" styleClass="form-control input-sm" >
                                                    <a4j:ajax event="keyup" render="knows@body knows@footer" execute="@header" queueId="slowQueue"/>
                                                    <a4j:ajax event="mousedown" execute="knows" queueId="slowQueue"/>
                                                </h:inputText>
                                            </div>
                                        </div>
                                    </rich:column>
                                    <rich:column/>
                                </rich:columnGroup>
                            </f:facet>

                            <rich:column>
                                <h:outputText value="#{pkg.name}"/>
                            </rich:column>
                            <rich:column>
                                <h:outputText value="#{pkg.sbr.name}"/>
                            </rich:column>
                            <rich:column>
                                <h:selectOneMenu value="#{knowledgeForm.knowledges[pkg]}" converter="javax.faces.Integer" styleClass="form-control" style="width: 200px;y">
                                    <f:selectItem itemLabel="-- no knowledge --" itemValue="-1" noSelectionOption="true"/>
                                    <f:selectItem itemLabel="Beginner" itemValue="0"/>
                                    <f:selectItem itemLabel="Intermediate" itemValue="1"/>
                                    <f:selectItem itemLabel="Expert" itemValue="2"/>
                                </h:selectOneMenu>
                            </rich:column>

                            <f:facet name="footer">
                                <ul class="pagination">
                                    <a4j:repeat value="#{knowledgeForm.pkgModelHelper.pagination.listPages(5)}" var="page">
                                        <li class="#{knowledgeForm.pkgModelHelper.pagination.currentPage eq page ? 'active' : ''}">
                                            <a4j:commandLink value="#{page}" action="#{knowledgeForm.pkgModelHelper.pagination.goToPage(page)}" render="@body @header @footer" />
                                        </li>
                                    </a4j:repeat>
                                </ul>
                            </f:facet>

                        </rich:dataTable>



                    </rich:togglePanelItem>
                    <rich:togglePanelItem name="list">
                        <div style="width: 60%; margin-left: auto; margin-right: auto;">
                            <rich:dataTable value="#{allSBRs}" var="sbr" styleClass="table" rowClass="active" >
                                <f:facet name="header">
                                    <rich:columnGroup>
                                        <rich:column>
                                            SBR Name
                                        </rich:column>
                                        <rich:column></rich:column>
                                    </rich:columnGroup>
                                </f:facet>

                                <rich:column colspan="2" rendered="#{not empty sbr.packages}">
                                    <rich:collapsibleSubTableToggler for="sbrsection" collapsedLabel="#{sbr.name}" expandedLabel="#{sbr.name}" />
                                </rich:column>
                                <rich:collapsibleSubTable expanded="#{false}"  value="#{sbr.packages}" var="pkg" id="sbrsection">
                                    <rich:column>
                                        <h:outputText value="#{pkg.name}"/>
                                    </rich:column>
                                    <rich:column>
                                        <h:selectOneMenu value="#{knowledgeForm.knowledges[pkg]}" converter="javax.faces.Integer"
                                                         styleClass="form-control" style="width: 200px;">
                                            <f:selectItem itemLabel="-- no knowledge --" itemValue="-1" noSelectionOption="true"/>
                                            <f:selectItem itemLabel="Beginner" itemValue="0"/>
                                            <f:selectItem itemLabel="Intermediate" itemValue="1"/>
                                            <f:selectItem itemLabel="Expert" itemValue="2"/>
                                        </h:selectOneMenu>
                                    </rich:column>
                                </rich:collapsibleSubTable>
                            </rich:dataTable>
                        </div>

                    </rich:togglePanelItem>
                </rich:togglePanel>
                <h:commandButton value="Submit" action="#{knowledgeForm.submit}" styleClass="btn btn-primary"/>

            </h:form>
        </h:panelGroup>
    </ui:define>
</ui:composition>