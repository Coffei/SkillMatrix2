<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	template="/WEB-INF/templates/default.xhtml"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j">

	<ui:define name="title">SBR <h:outputText
			value="#{sbrDetails.sbr.name}" rendered="#{sbrDetails.sbr ne null}" />
	</ui:define>
	<ui:define name="content">
		<h:outputStylesheet>
   .slim {
   		width: 300px;
    }
   </h:outputStylesheet>
   
   <a4j:queue requestDelay="100" ignoreDupResponses="true"/>


		<h:panelGroup rendered="#{sbrDetails.sbr eq null}">
			<h2>
				<h:outputText value="No sbr found." />
			</h2>
			<h2>
				<h:outputLink value="./sbrs.jsf">View all SBRs</h:outputLink>
			</h2>
		</h:panelGroup>

		<h:panelGroup rendered="#{sbrDetails.sbr ne null}">
			<h1>
				SBR:
				<h:outputText value="#{sbrDetails.sbr.name}" />
			</h1>
			<h2>
				<h:outputText rendered="#{sbrDetails.sbr.coach eq null}"
					value="No SBR coach assigned" />
				<h:panelGroup rendered="#{sbrDetails.sbr.coach ne null}">
  	     	SBR Coach:
  	     	 <h:outputLink
						value="memberdetail.jsf?id=#{sbrDetails.sbr.coach.id}">
						<h:outputText value="#{sbrDetails.sbr.coach.name}"
							style="font-size: small; color: black;" />
					</h:outputLink>
				</h:panelGroup>
			</h2>


			<rich:collapsiblePanel header="People in SBR" switchType="client">
				<h:panelGroup rendered="#{not sbrDetails.hasMembers()}">
					<h3>
						<h:outputText value="This SBR has no members." />
					</h3>
				</h:panelGroup>


				<ui:repeat var="i" value="#{sbrDetails.memberSbrCount}">
					<h:form>
						<rich:dataTable id="members"
							value="#{sbrDetails.sortHelpers[i-1].model}" var="member"
							rows="8" styleClass="simpletablestyle"
							columnClasses="namecol,namecol,namecol,langcol,numcol,actioncol">
							<f:facet name="caption">
								<h3>
									<h:outputText
										value="#{i}. SBR: (#{sbrDetails.getMembersCount(i)})" />
								</h3>
							</f:facet>
							<rich:column>
								<f:facet name="header">
									<a4j:commandLink value="Name "
										action="#{sbrDetails.sortHelpers[i-1].sortByName}"
										render="members" styleClass="whitelink" /><br/>
									<h:inputText value="#{sbrDetails.sortHelpers[i-1].nameFilter}"
										size="13">
										<a4j:ajax event="keyup" render="@body @footer" execute="@this" />
									</h:inputText>
								</f:facet>
								<h:outputText value="#{member.name}" styleClass="name" />
							</rich:column>

							<rich:column>
								<f:facet name="header">
									<a4j:commandLink value="Nick  "
										action="#{sbrDetails.sortHelpers[i-1].sortByNick}"
										render="members" styleClass="whitelink" /><br/>
									<h:inputText value="#{sbrDetails.sortHelpers[i-1].nickFilter}"
										size="8">
										<a4j:ajax event="keyup" render="@body @footer" execute="@this" />
									</h:inputText>
								</f:facet>
								<h:outputText value="#{member.nick}" />
							</rich:column>

							<rich:column>
								<f:facet name="header">
									<a4j:commandLink value="Email  "
										action="#{sbrDetails.sortHelpers[i-1].sortByEmail}"
										render="members" styleClass="whitelink" /><br/>
									<h:inputText value="#{sbrDetails.sortHelpers[i-1].emailFilter}"
										size="15">
										<a4j:ajax event="keyup" render="@body @footer" execute="@this" />
									</h:inputText>
								</f:facet>
								<h:outputText value="#{member.email}" />
							</rich:column>
							
							<rich:column>
								<f:facet name="header">
									Languages<br/>
									<h:inputText value="#{sbrDetails.sortHelpers[i-1].languagesFilter}" size="8">
										<a4j:ajax event="keyup" render="@body @footer" execute="@this" />
									</h:inputText>
								</f:facet>
							
								<h:outputText value="#{sbrDetails.joinLanguages(member.knowledges)}" />
							</rich:column>


							<rich:column sortBy="#{sbrDetails.experts[member]}" id="experts"
								sortOrder="#{sbrDetails.sortHelpers[i-1].experts}">
								<f:facet name="header">
									<a4j:commandLink value="Expert" render="members"
										action="#{sbrDetails.sortHelpers[i-1].sortByExperts}"
										title="Number of tags the member has expert knowledge of"
										styleClass="whitelink" />
								</f:facet>
								<h:outputText value="#{sbrDetails.experts[member]}" />
							</rich:column>

							<rich:column>
								<f:facet name="header">Actions</f:facet>
								<h:outputLink value="memberdetail.jsf?id=#{member.id}">view </h:outputLink>
								<h:outputLink value="./memberform.jsf?editid=#{member.id}">edit </h:outputLink>
								<h:commandLink
									onclick="return confirm('Do you really want to delete member #{member.name}?')"
									action="#{memberController.delete(member)}" value="delete" />

							</rich:column>
							<f:facet name="footer">
								<rich:dataScroller for="members" maxPages="5" fastStep="10" />
							</f:facet>
						</rich:dataTable>
					</h:form>

				</ui:repeat>
			</rich:collapsiblePanel>


			<rich:collapsiblePanel
				header="Tags in SBR: (#{sbrDetails.sbr.packages.size()}) "
				switchType="client">
				<h:panelGroup rendered="#{sbrDetails.pkgHelper.model.isEmpty()}">
					<h3>
						<h:outputText value="No tag" />
					</h3>
				</h:panelGroup>

				<h:form>
					<rich:dataTable id="pkgs" value="#{sbrDetails.pkgHelper.model}"
						rows="8" var="pkg" rendered="#{not sbrDetails.pkgHelper.model.isEmpty()}"
						styleClass="simpletablestyle"
						columnClasses="namecol,numcol,actioncol">
						<rich:column>
							<f:facet name="header">
								<a4j:commandLink value="Name "
									action="#{sbrDetails.pkgHelper.sortByName}"
									render="pkgs" styleClass="whitelink" /><br/>
								<h:inputText value="#{sbrDetails.pkgHelper.nameFilter}"
									size="15">
									<a4j:ajax event="keyup" render="@body @footer" execute="@this" />
								</h:inputText>
							</f:facet>
							<h:outputText value="#{pkg.name}" styleClass="name" />
						</rich:column>

						<rich:column sortBy="#{packageController.getExperts(pkg)}"
							sortOrder="#{sbrDetails.pkgHelper.expertsOrder}">
							<f:facet name="header">
								<a4j:commandLink value="Members"
									action="#{sbrDetails.pkgHelper.sortByExperts}"
									render="pkgs" styleClass="whitelink" />
							</f:facet>
							<h:outputText value="#{packageController.getExperts(pkg) }" />
						</rich:column>

						<rich:column>
							<f:facet name="header">Actions</f:facet>
							<h:outputLink value="./pkgdetail.jsf?id=#{pkg.id}">view </h:outputLink>
							<h:outputLink value="./pkgform.jsf?editid=#{pkg.id}">edit </h:outputLink>
							<h:commandLink
								onclick="return confirm('Do you really want to delete tag #{pkg.name}?')"
								action="#{packageController.deletePackage(pkg)}" value="delete" />
						</rich:column>

						<f:facet name="footer">
							<rich:dataScroller for="pkgs" maxPages="5" fastStep="10" />
						</f:facet>

					</rich:dataTable>
				</h:form>
			</rich:collapsiblePanel>
			<rich:collapsiblePanel header="People with best knowledge"
				switchType="client" rendered="#{not empty sbrDetails.bestPeople}">
				<rich:dataTable id="bestpeople"
					value="#{sbrDetails.bestPeople.entrySet().toArray()}" var="entry"
					rows="5" styleClass="simpletablestyle"
					columnClasses="namecol,namecol,actioncol, actioncol">
					<rich:column>
						<f:facet name="header">Name</f:facet>
						<h:outputText value="#{entry.key.name}" styleClass="name" />
					</rich:column>
					<rich:column>
						<f:facet name="header">Nick</f:facet>
						<h:outputText value="#{entry.key.nick}" />
					</rich:column>
					<rich:column sortBy="#{entry.value}" sortOrder="descending">
						<f:facet name="header">Knowledge of this SBR</f:facet>
						<h:outputText value="#{entry.value}%" />
					</rich:column>
					<rich:column>
						<f:facet name="header">Actions</f:facet>
						<h:outputLink value="memberdetail.jsf?id=#{entry.key.id}">view</h:outputLink>
					</rich:column>

					<f:facet name="footer">
						<rich:dataScroller for="bestpeople" fastControls="hide" />
					</f:facet>

				</rich:dataTable>

			</rich:collapsiblePanel>

		</h:panelGroup>
	</ui:define>
</ui:composition>